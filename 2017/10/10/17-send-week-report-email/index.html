<!DOCTYPE html><html lang="zh-ch"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 用 Python 写脚本发送工作周报 · 阿斌的技术博客</title><meta name="description" content="用 Python 写脚本发送工作周报 - Abin"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.iosgg.cn/atom.xml" title="阿斌的技术博客"><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="阿斌的技术博客" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="https://github.com/wxiubin" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">用 Python 写脚本发送工作周报</h1><div class="post-info">Oct 10, 2017</div><div class="post-content"><p>事情的起因是这样的，每周都要发送工作周报，标题是需要的固定的格式（方便规则收信），比如 <em>【工作周报】 xxx 11.20-11.24</em>，发送和抄送也是给固定的人，企业邮箱还没有模板，所以每次发邮件都要复制粘贴标题、发送人和抄送人，只有内容是手写，便萌发了用脚本发送邮件的想法。</p>
<a id="more"></a>

<p>用脚本只需要第一次使用的时候配置收件人、抄送人和标题的格式，之后就只需要：</p>
<ol>
<li>双击脚本文件</li>
<li>输入时间，如 11.20-11.24</li>
<li>输入周报内容</li>
</ol>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 配置项</span><br><span class="line">from_addr 	&#x3D; &#39;wangxiubin@bbbbbbbb.com&#39; # 发送方邮箱</span><br><span class="line">password 	&#x3D; &#39;passMhr22i6Uword&#39; 		# 发送方邮箱的密码（企业邮箱-设置-客户端专用密码）</span><br><span class="line">to_addr 	&#x3D; &#39;abcdefg@bbbbbbbb.com&#39; 	# 收件人邮箱</span><br><span class="line">cc_addr 	&#x3D; &#39;abcdrfghij@bbbbbbbb.com&#39;	# 抄送人邮箱</span><br><span class="line"></span><br><span class="line">from_name	&#x3D; &#39;王修斌&#39;					# 发件人姓名</span><br><span class="line"></span><br><span class="line"># QQ 企业邮箱不用修改</span><br><span class="line">smtp_addr 	&#x3D; &#39;smtp.exmail.qq.com&#39;</span><br><span class="line">smtp_port 	&#x3D; 465</span><br></pre></td></tr></table></figure>

<h3 id="构建邮件"><a href="#构建邮件" class="headerlink" title="构建邮件"></a>构建邮件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def _build_msg(content,date):</span><br><span class="line">	msg &#x3D; MIMEText(content, &#39;plain&#39;, &#39;utf-8&#39;)</span><br><span class="line">	msg[&#39;From&#39;] 	&#x3D; _format_addr(&#39;%s &lt;%s&gt;&#39; % (from_name, from_addr) )</span><br><span class="line">	msg[&#39;To&#39;] 		&#x3D; _format_addr( &#39;zhuyue &lt;%s&gt;&#39; % to_addr )</span><br><span class="line">	msg[&#39;CC&#39;] 		&#x3D; _format_addr( &#39;bplus-ios &lt;%s&gt;&#39; % cc_addr )</span><br><span class="line">	msg[&#39;Subject&#39;] 	&#x3D; Header(&#39;【B+iOS周报】 %s %s&#39; % (from_name, date), &#39;utf-8&#39;).encode()</span><br><span class="line">	return msg</span><br></pre></td></tr></table></figure>


<h3 id="发送邮件"><a href="#发送邮件" class="headerlink" title="发送邮件"></a>发送邮件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">def send_email(msg):</span><br><span class="line">	print</span><br><span class="line">	try:</span><br><span class="line">		print &#39;初始化 SMTP...&#39;</span><br><span class="line">		server &#x3D; smtplib.SMTP_SSL(smtp_addr, smtp_port)</span><br><span class="line">		print &#39;初始化 SMTP 成功&#39;</span><br><span class="line">		# server.set_debuglevel(1)</span><br><span class="line">		print &#39;开始登陆邮箱服务...&#39;</span><br><span class="line">		server.login(from_addr, password)</span><br><span class="line">		print &#39;开始发送邮件...&#39;</span><br><span class="line">		server.sendmail(from_addr, [to_addr], msg.as_string())</span><br><span class="line">		print &#39;邮件发送成功！&#39;</span><br><span class="line">	except server.SMTPException,e:</span><br><span class="line">	    print &#39;邮件发送失败 %s&#39; % e</span><br><span class="line">	finally:</span><br><span class="line">	    server.quit()</span><br></pre></td></tr></table></figure>

<h3 id="GUI"><a href="#GUI" class="headerlink" title="GUI"></a>GUI</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">def sendEmailCommand():</span><br><span class="line">	</span><br><span class="line">	input_date &#x3D; app.dateInput.get()</span><br><span class="line">	msg_content &#x3D; app.content.get(&quot;0.0&quot;, &quot;end&quot;)</span><br><span class="line">	send_email(_build_msg(msg_content, input_date))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Application(Frame):</span><br><span class="line">    def __init__(self, master&#x3D;None):</span><br><span class="line">        Frame.__init__(self, master)</span><br><span class="line">        self.pack()</span><br><span class="line">        self.createWidgets()</span><br><span class="line"></span><br><span class="line">    def createWidgets(self):</span><br><span class="line">    	self.header &#x3D; Frame()</span><br><span class="line">        self.dateLabel &#x3D; Label(self.header, text&#x3D;&#39;周报标题日期(如 11.20-11.24)：&#39;)</span><br><span class="line">        self.dateLabel.grid(row&#x3D;0,column&#x3D;0)</span><br><span class="line">        self.dateInput &#x3D; Entry(self.header)</span><br><span class="line">        self.dateInput.grid(row&#x3D;0,column&#x3D;1)</span><br><span class="line">        self.sendButton &#x3D; Button(self.header, text&#x3D;&#39;发送&#39;, command&#x3D;sendEmailCommand)</span><br><span class="line">        self.sendButton.grid(row&#x3D;0,column&#x3D;2)</span><br><span class="line">        self.content &#x3D; Text(self,padx&#x3D;10)</span><br><span class="line">        self.content.insert(END, &#39;本周任务：\n\n下周任务：\n\n风险评估：\n&#39;)</span><br><span class="line">        self.content.pack()</span><br><span class="line">    	self.header.pack()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app &#x3D; Application()</span><br><span class="line"># 设置窗口标题:</span><br><span class="line">app.master.title(&#39;发送周报邮件&#39;)</span><br><span class="line"># 主消息循环:</span><br><span class="line">app.mainloop()</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd 脚本目录</span><br><span class="line">python GUI.py</span><br></pre></td></tr></table></figure>

<p>或者修改名称 <code>GUI.command</code> 方便双击打开。<br>执行时提示权限不足可在终端执行 <code>chmod +x GUI.command</code></p>
<h3 id="效果预览"><a href="#效果预览" class="headerlink" title="效果预览"></a>效果预览</h3><p><img src="/images/2017-10-10-send-week-report-email.png" alt="效果预览"></p>
<p>终端输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">初始化 SMTP...</span><br><span class="line">初始化 SMTP 成功</span><br><span class="line">开始登陆邮箱服务...</span><br><span class="line">开始发送邮件...</span><br><span class="line">邮件发送成功！</span><br></pre></td></tr></table></figure>

<p>最终只需要在脚本的图形界面中输入时间段和内容，然后点击发送，美滋滋~ 以后再也不用 <code>command+C</code> 、<code>command+V</code> 了</p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/01/26/18-iOS-crash/" class="prev">PREV</a><a href="/2017/06/18/14-autoreleasepool/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2022 <a href="http://blog.iosgg.cn">Abin</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/m-forks/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-100885072-1",'auto');ga('send','pageview');</script></body></html>